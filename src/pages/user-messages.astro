---
import Layout from '../layouts/Layout.astro';
---

<Layout title="User Messages">
  <main>
    <h1>User Messages</h1>
    <div id="messages-container">
      <div id="messages"></div>
    </div>
    <!-- Der "Zurück zur Seite" Button als Pfeil -->
    <button id="back-button">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
        <path d="M14 7l-5 5 5 5V7z"/>
      </svg>
      Zurück
    </button>
  </main>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    let messages = JSON.parse(localStorage.getItem('messages')) || [];
    const messagesContainer = document.getElementById('messages');
    const messagesContainerWrapper = document.getElementById('messages-container');
    const backButton = document.getElementById('back-button');

    function renderMessages() {
      if (!messagesContainer) return; // Sicherheitsüberprüfung

      messagesContainer.innerHTML = '';

      messages.forEach((msg, index) => {
        const messageEl = document.createElement('div');
        messageEl.classList.add('message');
        messageEl.innerHTML = `
          <p><strong>${msg.title}</strong></p>
          <p><strong>${msg.username || 'Anonym'}:</strong> ${msg.message}</p>
          <div class="replies">
            ${msg.replies ? msg.replies.map(reply => `<div class="reply"><strong>${reply.username}:</strong> ${reply.message}</div>`).join('') : ''}
          </div>
          <button class="delete-button" data-index="${index}">Löschen</button>
        `;

        messagesContainer.appendChild(messageEl);
      });

      // Scrollen zum neuesten Eintrag
      messagesContainerWrapper.scrollTop = messagesContainerWrapper.scrollHeight;
    }

    messagesContainer?.addEventListener('click', function(event) {
      const target = event.target as HTMLElement;

      if (target.classList.contains('delete-button')) {
        const index = target.getAttribute('data-index');
        if (index === null) return;

        if (confirm('Sind Sie sicher, dass Sie diese Nachricht löschen möchten?')) {
          messages.splice(parseInt(index), 1); // Nachricht aus dem Array entfernen
          localStorage.setItem('messages', JSON.stringify(messages)); // Array speichern
          renderMessages(); // Seite aktualisieren
          alert('Nachricht wurde gelöscht!');
        }
      }
    });

    // Zurück-Button Logik
    backButton.addEventListener('click', () => {
      window.history.back();  // Gehe zur vorherigen Seite
    });

    renderMessages();
  });
</script>

<style>
    :root {
      --background-main: #f4f6f9;
      --text-dark: #333;
      --button-background: #007BFF;
      --button-hover: #0056b3;
      --button-text: #fff;
      --main-background: #fff;
      --header-bg: #fff;
      --footer-bg: #f4f6f9;
      --message-background: #fff;
      --message-border: #ddd;
      --reply-background: #f4f4f4;
      --reply-border: #ddd;
      --delete-button-background: #dc3545;
      --delete-button-hover: #c82333;
      --back-button-background: #28a745;
      --back-button-hover: #218838;
    }

    body {
      background: var(--background-main);
      color: var(--text-dark);
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      background: var(--header-bg);
      padding: 1rem;
      color: var(--text-dark);
      text-align: center;
      box-shadow: 0 2px 4px rgb(0 0 0 / 10%);
    }

    header h1 {
      margin: 0;
      font-size: 24px;
    }

    nav a {
      color: var(--button-background);
      text-decoration: none;
      margin: 0 0.5rem;
    }

    main {
      padding: 1.5rem;
      width: 100%;
      max-width: 600px;
      color: rgb(11 11 11);
      font-size: 16px;
      line-height: 1.6;
      position: relative;
      background: var(--main-background);
      border-radius: 12px;
      box-shadow: 0 6px 12px rgb(0 0 0 / 10%);
      margin: 2rem auto;
    }

    #messages-container {
      border: none; /* Kein Rahmen für den Container */
      background: var(--main-background); /* Weißer Hintergrund für Container */
      padding: 1rem;
      max-height: 500px;
      overflow-y: auto;
    }

    .message {
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 8px;
      background: var(--message-background); /* Weißer Hintergrund für Nachrichten */
      border: 1px solid var(--message-border); /* Rahmen für Nachrichten */
      box-shadow: 0 2px 4px rgb(0 0 0 / 10%); /* Leichter Schatten */
    }

    .message:last-child {
      margin-bottom: 0;
    }

    .replies {
      margin-top: 1rem;
      padding-left: 1rem;
      border-left: 2px solid var(--message-border);
    }

    .reply {
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-radius: 8px;
      background: var(--reply-background);
      border: 1px solid var(--reply-border);
    }

    .delete-button {
      margin-top: 1rem;
      padding: 0.75rem 1.5rem;
      background: var(--delete-button-background); /* Rote Hintergrundfarbe für Löschen-Button */
      color: var(--button-text);
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .delete-button:hover {
      background: var(--delete-button-hover); /* Dunkleres Rot für Hover-Effekt */
    }

    #back-button {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--back-button-background); /* Grüner Hintergrund für "Zurück"-Button */
      color: var(--button-text);
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgb(0 0 0 / 10%);
      cursor: pointer;
      transition: background 0.3s ease, transform 0.3s ease;
    }

    #back-button:hover {
      background: var(--back-button-hover); /* Dunkleres Grün für Hover-Effekt */
    }

    #back-button svg {
      fill: currentcolor;
    }
  </style>
</body>
</html>